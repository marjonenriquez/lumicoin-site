<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Support & Feedback | L√ºmiCoin</title>
  <meta name="description" content="Submit feedback, report bugs, or ask questions directly to the L√ºmiCoin team.">
  <link rel="icon" href="/lumicoin-logo.png" type="image/png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="/style.css">
</head>
<body>

  <header class="site-header">
    <div class="container">
      <a href="/" class="logo-link">
        <img src="/lumicoin-logo.png" alt="L√ºmiCoin Logo">
        <span class="logo-text">L√ºmiCoin</span>
      </a>
      <button class="nav-toggle" aria-label="Open navigation" aria-expanded="false">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <nav class="main-nav" id="mainNav">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/manifesto/">Manifesto</a></li>
          <li><a href="/support/" class="active">Support</a></li>
          <li><a href="/terms/">Terms</a></li>
          <li><a href="/privacy/">Privacy</a></li>
        </ul>
      </nav>
      <div class="nav-overlay"></div>
    </div>
  </header>

  <main>
    <section class="page-section support-page">
      <div class="container-narrow">
        <h1 class="page-title">Support & Feedback</h1>
        <p class="page-subtitle">Have a question, bug report, or feature idea? We're all ears! Your input is invaluable in helping us make L√ºmiCoin the best it can be. Our founder personally reviews every submission.</p>

        <div class="form-container">
          <form id="feedbackForm">
            <div class="form-group">
              <label for="feedbackType">What's this about?</label>
              <select id="feedbackType" name="feedbackType" required>
                <option value="" disabled selected>Choose a category‚Ä¶</option>
                <option value="General Feedback">üí¨ General Feedback</option>
                <option value="Bug Report">üêõ Bug Report</option>
                <option value="Feature Request">‚ú® Feature Request</option>
                <option value="Question">‚ùì Question</option>
                <option value="Partnership Inquiry">ü§ù Partnership Inquiry</option>
                <option value="Other">üìã Other</option>
              </select>
            </div>

            <div class="form-group">
              <label for="userEmail">Your Email <span class="label-optional">(optional, for replies)</span></label>
              <input type="email" id="userEmail" name="userEmail" placeholder="you@example.com">
            </div>

            <div class="form-group">
              <label for="feedbackMessage">Your Message</label>
              <textarea id="feedbackMessage" name="feedbackMessage" rows="7" placeholder="Please describe your issue or suggestion in detail‚Ä¶" required></textarea>
            </div>

            <button type="submit" class="btn" id="submitButton" style="width: 100%;">
              <span class="btn-text">Send to Founder</span>
            </button>

            <div id="formMessageContainer" style="margin-top: var(--spacing-md);"></div>
          </form>
        </div>

        <div class="app-submission-note">
          <p><strong>Using the L√ºmiCoin app?</strong> For the best support experience, please submit feedback via the app (Settings > Feedback & Support). This automatically includes helpful diagnostic information.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/manifesto/">Manifesto</a></li>
          <li><a href="/support/">Support</a></li>
          <li><a href="/terms/">Terms</a></li>
          <li><a href="/privacy/">Privacy</a></li>
        </ul>
      </nav>
      <p>¬© <span id="currentYear">2025</span> L√ºmiCoin. All rights reserved.</p>
    </div>
  </footer>
  
  <script>
    document.getElementById('currentYear').textContent = new Date().getFullYear();
    const navToggle = document.querySelector('.nav-toggle');
    const mainNav = document.getElementById('mainNav');
    const navOverlay = document.querySelector('.nav-overlay');

    function toggleNav() {
      const isOpen = mainNav.classList.contains('is-open');
      mainNav.classList.toggle('is-open');
      navToggle.setAttribute('aria-expanded', !isOpen);
      navToggle.classList.toggle('is-active');
      if (navOverlay) navOverlay.style.display = isOpen ? 'none' : 'block';
    }

    navToggle.addEventListener('click', toggleNav);
    if (navOverlay) {
      navOverlay.addEventListener('click', toggleNav);
    }
  </script>

  <!-- Firebase SDK and form logic -->
  <script type="module">
    // IMPORTANT: Replace with your actual Firebase configuration
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY_HERE", // Replace
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com", // Replace
      projectId: "YOUR_PROJECT_ID_HERE", // Replace
      storageBucket: "YOUR_PROJECT_ID.appspot.com", // Replace
      messagingSenderId: "YOUR_SENDER_ID_HERE", // Replace
      appId: "YOUR_APP_ID_HERE" // Replace
    };

    // Check if placeholder values are still there
    if (firebaseConfig.apiKey === "YOUR_API_KEY_HERE" || firebaseConfig.projectId === "YOUR_PROJECT_ID_HERE") {
        console.warn("Firebase configuration is using placeholder values. Please update with your actual Firebase project details for the form to work.");
    }
    
    let db, collection, addDoc, serverTimestamp;
    // Only attempt to initialize Firebase if config is not placeholder
    if (firebaseConfig.apiKey !== "YOUR_API_KEY_HERE" && firebaseConfig.projectId !== "YOUR_PROJECT_ID_HERE") {
        try {
            const firebaseAppModule = await import("https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js");
            const firestoreModule = await import("https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js");
            
            const app = firebaseAppModule.initializeApp(firebaseConfig);
            db = firestoreModule.getFirestore(app);
            collection = firestoreModule.collection;
            addDoc = firestoreModule.addDoc;
            serverTimestamp = firestoreModule.serverTimestamp;
        } catch (error) {
            console.error("Firebase SDK could not be initialized. Ensure Firebase config is correct and network is available.", error);
        }
    } else {
        console.warn("Firebase not initialized due to placeholder configuration values.");
    }


    const feedbackForm = document.getElementById("feedbackForm");
    const submitButton = document.getElementById("submitButton");
    const buttonTextSpan = submitButton.querySelector(".btn-text");
    const formMessageContainer = document.getElementById("formMessageContainer");

    feedbackForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!db) { 
          showMessage("Feedback system is currently unavailable. Please check Firebase configuration or try again later.", "error");
          return;
      }

      formMessageContainer.innerHTML = "";
      const originalButtonText = buttonTextSpan.textContent;
      buttonTextSpan.innerHTML = `<span class="btn-spinner"></span>Submitting‚Ä¶`;
      submitButton.disabled = true;

      const type = document.getElementById("feedbackType").value;
      const email = document.getElementById("userEmail").value.trim();
      const message = document.getElementById("feedbackMessage").value.trim();

      if (!type || !message) {
        showMessage("Please fill out all required fields.", "error");
        buttonTextSpan.textContent = originalButtonText;
        submitButton.disabled = false;
        return;
      }

      const payload = {
        type: type,
        message: message,
        email: email || null,
        source: "web-support-page",
        submittedAt: serverTimestamp(),
        userAgent: navigator.userAgent,
        url: window.location.href
      };

      try {
        await addDoc(collection(db, "feedbackSubmissions"), payload); 
        showMessage("Thank you! Your feedback has been submitted. We'll review it shortly.", "success");
        feedbackForm.reset();
      } catch (error) {
        console.error("Error writing feedback to Firestore:", error);
        showMessage(`Failed to send feedback: ${error.message}. Please try again or contact us directly.`, "error");
      } finally {
        buttonTextSpan.textContent = originalButtonText;
        submitButton.disabled = false;
      }
    });

    function showMessage(message, type) {
      formMessageContainer.innerHTML = `<div class="form-message message-${type}">${message}</div>`;
    }
  </script>
</body>
</html>
